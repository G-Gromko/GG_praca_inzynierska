\documentclass[xodstep]{wnspt}

\author      {Grzegorz Gromko}
\nralbumu    {80385}
\kierunek    {Informatyka}
\specjalnosc {Inżynieria oprogramowania}
\date        {2024}
\miejsce     {Częstochowa,}
\opiekun     {dr hab. Andrzej Zbrzezny, prof. UJD}
\opiekunpom  {}

\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[polish]{babel}
\usepackage{polski}
\usepackage{times}
\usepackage{colortbl}
\usepackage{hyperref}
\usepackage{multibib}
\usepackage{url}
\usepackage{setspace}
\usepackage{indentfirst}
\usepackage{listingsutf8}
\usepackage{beramono}
\usepackage[section]{placeins}
\usepackage{csquotes}
\usepackage{abstract}
\usepackage{graphicx}
\usepackage{float}
\usepackage{pythonhighlight}
\usepackage{gensymb}
%\usepackage[%backend=biber,refsegment=section,defernumbers=true,]{biblatex}

\lstset { %
language=python,                  % choose the language of the code
basicstyle=\ttfamily,           % the fonts that are used for the code
numbers=left,                   % where to put the line-numbers
numberstyle=\footnotesize,      % the size of the fonts that are used for the line-numbers
stepnumber=1,                   % the step between two line-numbers. If it's 1 each line will be
numbersep=5pt,                  % how far the line-numbers are from the code
showspaces=false,               % show spaces adding particular underscores
showstringspaces=false,         % underline spaces within strings
showtabs=false,                 % show tabs within strings adding particular underscores
frame=single,                   % adds a frame around the code
tabsize=4,                      % sets default tabsize to 2 spaces
captionpos=b,                   % sets the caption-position to bottom
breaklines=true,                % sets automatic line breaking
breakatwhitespace=false,        % sets if automatic breaks should only happen at whitespace
escapeinside={\%*}{*)}         % if you want to add a comment within your code 
}

\newcommand{\R}{mathbb{R}}

\renewcommand{\lstlistlistingname}{Spis listingów}
\renewcommand{\lstlistingname}{Listing}

\newtheorem{lemat}{Lemat}
\newtheorem{twierdzenie}{Twierdzenie}

\title{ Projekt i implementacja programu do optycznego rozpoznawania i przetwarzania zapisu nutowego do formatu MIDI w języku Python
\\{~}
Design and implementation of a program for optical recognition and processing of musical notation to MIDI format in Python}

\frenchspacing

\begin{document}

\maketitle
\onehalfspacing

\begin{abstract}
	Celem niniejszej pracy jest stworzenie programu służącego do optycznego rozpoznawania zapisu nutowego na fortepian z plików graficznych oraz przetworzenia wydobytych informacji semantycznych do pliku w formacie MIDI. Program wykorzystuje jeden z najnowocześniejszych modeli głębokiego uczenia do rozpoznawania muzyki oraz dzięki wbudowanemu przetwarzaniu obrazu jest w stanie odczytać informacje z wypaczonych stron zawierających zapis nutowy.
\end{abstract}



\introduction


Muzyka towarzyszy ludzkości od zarania dziejów, towarzysząc jej w sprawach codziennych, oraz tych podniosłych, będąc ważnym elementem wszystkich kultur świata i odkąd jesteśmy w stanie przechowywać swoją wiedzę na fizycznych nośnikach, niezależnie od tego, czy tym nośnikiem jest pergamin czy dysk półprzewodnikowy, dokonywane są starania, by tę kulturę zachować. Przed wynalezieniem druku archiwizacja wszelkich informacji dokonywana była ręcznie, znak po znaku na każdej kopii, co jest procesem wybitnie czasochłonnym, który udało się znacznie przyśpieszyć dzięki prasie drukarskiej, przez którą tworzenie duplikatów stało się znacznie bardziej dostępne i powszechne. Dodatkowo wynalezienie druku pośrednio spowodowało, że różne systemy zapisu języka, jak i również muzyki, naturalnie się usystematyzowały w przeciągu wieków, by czytelnik na drugim końcu kraju czy kontynentu był w stanie bez problemu oczytać informacje, które znajdują się na kartkach, bez konieczności studiowania niuansów zapisu z danego fragmentu świata. Takim sposobem w XVII wieku wraz z popularyzacją muzyki instrumentalnej w europie narodziła się nowożytna zachodnia notacja muzyczna, będąca do dzisiaj najszerzej stosowaną metodą zapisu. Składa się ona z nut, określających długości dźwięku, umieszczonych na pięciolinii, wraz z którą w relacji określają wysokość tego dźwięku. Dodatkowe elementy jak pauzy, będące znakami określającymi długości przerw między dźwiękami oraz inne symbole pozwalają na zapis praktycznie każdego możliwego dźwięku wydawanego przez instrumenty oraz melodii granych utworów. Pozwoliła ona na stworzenie najbardziej uniwersalnego języka do zapisu muzyki, użytkowanego w każdym możliwym gatunku, co znacznie ułatwia możliwości archiwizacyjne.

Nośniki takie jak papier degradują się z biegiem czasu, a ręczne kopiowanie rozległych katalogów kompozycji spisanych na kartkach wymaga wielkiego nakładu pracy, którego archiwiści nie zawsze są w stanie włożyć. Próby digitalizacji tej części dziedzictwa kulturowego nadeszły wraz z nadejściem ery komputerów posiadających odpowiednie moce obliczeniowe, by efektywnie analizować obrazy. Od ponad 50 lat badacze tworzą systemy rozpoznawania zapisów nutowych, zwane OMR (ang. Optical Music Recognition), czyli optycznym rozpoznawaniem muzyki, będących niezastąpionymi w procesie cyfrowej archiwizacji, jednak dopiero niedawno osiągnęły odpowiedni stopień dokładności, by być prawdziwie przydatnymi \cite{Hajicjr.2018}. 

Jest to pole badań, które jest znacznie mniejsze od optycznego rozpoznawania znaków, przez co nie rozwijało ono aż tak dynamicznie, gdyż nie posiada ono tak dużego potencjału na skomercjalizowanie rozwiązań, co powoduje znacznie mniejszą ilość materiałów wprowadzających w ten temat. Do tej pory ukazało się zaledwie trochę ponad 500 artykułów i innych publikacji. Jednocześnie jest ono pod względem definicji mocno rozbudowane, oraz nie posiada jednego ścisłego opisu, z tych powodów pole to nie należy do najłatwiejszych do rozpoczęcia w nim pracy\cite{Calvo-Zaragoza2020}, a które jest tak ważne w kwestii zachowania tej jakże ważnej części kultury. Dodatkowo rozpoznawanie muzyki jest znacznie trudniejsze od rozpoznawania tekstu, z racji swojej dwuwymiarowej natury i silnej relacji przestrzennej między elementami zapisu a ich znaczeniem.

Tradycyjnym podejściem do tematu odczytywania nut przez komputery jest podejście wielostopniowe \cite{Rebelo2012}, gdzie proces jest podzielony na kilka kroków, mianowicie: wstępne przetwarzanie obrazu, odnajdywanie odległości referencyjnych, wykrycie i usunięcie pięciolinii, segmentacja symboli i ich rozpoznanie oraz konstrukcja notacji muzycznej i ostateczna jej reprezentacja. Każdy krok posiada swoje własne trudności, przez co dzisiaj istnieje wiele możliwych podejść do prób ich rozwiązania. Przykładowo etap segmentacji symboli i ich rozpoznania został poruszony na wiele sposobów, między innymi poprzez analizę prymitywów zapisu nutowego, jak główki nut, pałeczki i chorągiewki \cite{Toyama2006}, grafy sąsiedztwa linii \cite{Reed1996}, ukrytych modeli Markova \cite{Pugin2006}, czy też poprzez użycie sieci neuronowych \cite{Mehta2015}. Pozostałe etapy również posiadają rozbudowany wachlarz udokumentowanych sposobów ich rozwiązania, gdzie w ostatnim czasie zaczęto używać do ich rozwiązywania technik głębokiego uczenia, które znacznie zwiększyły skuteczność każdego kroku \cite{Pacha2017}\cite{Gallego2017}, powodując, że uważa się niektóre kroki jako rozwiązane, lecz nie posuwając ostatecznie całości do przodu.

Pomimo swojej skuteczności, podejście wieloetapowe odchodzi z użycia, co jest spowodowane szybkim rozwojem głębokiego uczenia w ostatnich latach, dzięki któremu można stosować bardziej holistyczne podejścia, łączące w sobie kilka kroków na raz, czy też nawet niektóre kroki pomijając, jak usuwanie pięciolinii. Najnowsze badania dążą do opracowania modeli, które będą rozwiązywać cały ten problem w pojedynczym kroku, określane mianem \textit{end-to-end}, i dominują one dzisiaj pole rozwoju OMR \cite{Calvo-Zaragoza2018}\cite{Rios-Vila2023}. 

Jednakże pomimo tego dynamicznego rozwoju, modele te są ograniczone zazwyczaj do rozpoznawania tylko pojedynczych pięciolinii, czy podwójnych w wypadku nut do fortepianu, ze względu na zbiory danych, na których zostały wyuczone, które zazwyczaj zawierają właśnie tylko drobny fragment całości strony nut \cite{Calvo-Zaragoza2018b}\cite{Shatri2021}. Podejście to nie należy do najbardziej przydatnych w procesie archiwizacji, gdyż wymagałoby to oddzielnego fotografowania czy skanowania pięciolinii po pięciolinii. Tak wiec pomimo rozwoju systemów OMR dalej wymagają one wstępnego przetwarzania obrazu, polegającego na pocięciu wejściowej grafiki na mniejsze części, zawierające odpowiednie elementy, z których model jest w stanie wyciągnąć pożądane dane, lecz jest to zauważalnie prostsze zadanie niż wcześniej. 

Większość dostępnej literatury skupia się problemie wydobywania danych już z odpowiednio przygotowanych obrazów, które mogą być w pewien sposób zniekształcone, jednak proces digitalizacji zapisów nutowych dzisiaj odbywa się zazwyczaj przy pomocy zdjęć zrobionych przy użyciu przenośnych urządzeń, takich jak telefon wyposażony w aparat, zamiast skanerów. Jak takie podejście jest wygodniejsze dla użytkownika, gdyż w dzisiejszych czasach większość osób ma już przy sobie przez prawie cały czas urządzenia wyposażone w aparat, to niestety wszystkie układy optyczne wprowadzają dystorsję do wykonywanego obrazu, beczkową dla obiektywów szerokokątnych, czy poduszkową dla teleobiektywów, co powoduje niechciane zniekształcenia w zapisywanym obrazie. Kolejną wadą fotografowania dokumentów jest to, iż w przeciwieństwie do skanów, uzyskany obraz nie jest płaski i wyrównany z ewentualnym lekkim przechyleniem, które jest proste do poprawienia, tylko często posiada zniekształcenia we wszystkich wymiarach, jak na przykład gdy fotografuje się stronę książki, co skutkuje nieliniowymi wygięciami przy krawędziach stron. Powoduje to zmniejszenie skuteczności systemów, wymagając dodatkowego stopnia wstępnego przetwarzania obrazu, polegającego na usuwaniu wypaczenia, zanim zostanie on przekazany do odzyskania informacji przez wyuczony model.

Dlatego też celem niniejszej pracy jest zaprojektowanie i stworzenie programu, który pozwoli na odczytanie informacji zawartych w zapisie nutowym na fortepian ze zdjęć zrobionych przez użytkownika, by mógł je on wygodnie zdigitalizować do pliku MIDI. 

Zakres pracy obejmuje stworzenie programu w języku Python wykorzystujący model głębokiego ucznia end-to-end oparty na rekurencyjnych sieciach neuronowych opracowany przez Antonio Ríos-Vilę wytrenowany na zbiorze danych GrandStaff\cite{Rios-Vila2023}, proces usuwania wypaczenia stworzony przez Matta Zuckera, oraz algorytm odnajdywania pozycji pięciolinii opracowany przez Mariusza Szwocha \cite{Szwoch2005} oraz otwartoźródłowych bibliotek przyśpieszających tworzenie programu.

Praca składa się z pięciu rozdziałów. Rozdział 1 obejmuje określenie specyfikacji wymagań funkcjonalnych, niefunkcjonalnych oraz biznesowych stawianych tworzonemu programowi. Rozdział 2 omawia wykorzystane technologie w projekcie. Rozdział 3 pokazuje budowę programu przy użyciu diagramów UML oraz interfejsu użytkownika. Rozdział 4 przedstawia narzędzie programistyczne użyte podczas pracy nad projektem. Rozdział 5 opisuje implementację najważniejszych części powstałego programu.


\input{chapters/chapter1}
\input{chapters/chapter2}
\input{chapters/chapter3}
\input{chapters/chapter4}
\input{chapters/chapter5}

\summary
Tu podsumowanie z realizacji założeń, możliwości dalszej pracy

\bibliographystyle{plain}
\bibliography{literatura}

% spis tabel
\listoftables

% spis rysunków
\listoffigures

% spis listingów
\lstlistoflistings

\end{document}
